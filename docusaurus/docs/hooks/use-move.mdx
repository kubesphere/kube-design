---
sidebar_position: 22
---

# useMove

è·Ÿè¸ªé¼ æ ‡å’Œè§¦æ‘¸ç§»åŠ¨çš„ Hookï¼Œè¿”å›å…ƒç´ å†…çš„å½’ä¸€åŒ–åæ ‡ (0-1)ã€‚

## åŸºæœ¬ç”¨æ³•

```jsx live
function Demo() {
  const [value, setValue] = useState({ x: 0.5, y: 0.5 });
  const { ref, active } = useMove(setValue);

  return (
    <div>
      <div
        ref={ref}
        style={{
          width: '100%',
          height: '200px',
          backgroundColor: 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
          position: 'relative',
          cursor: 'crosshair',
        }}
      >
        <div
          style={{
            position: 'absolute',
            left: `${value.x * 100}%`,
            top: `${value.y * 100}%`,
            width: '20px',
            height: '20px',
            backgroundColor: active ? 'var(--ifm-color-primary)' : 'var(--ifm-color-primary-dark)',
            borderRadius: '50%',
            transform: 'translate(-50%, -50%)',
            transition: active ? 'none' : 'background-color 0.2s',
          }}
        />
      </div>
      <div
        style={{
          marginTop: '12px',
          padding: '12px',
          backgroundColor: 'var(--ifm-background-surface-color)',
          border: '1px solid var(--ifm-color-emphasis-300)',
          borderRadius: '6px',
          fontSize: '14px',
        }}
      >
        <div>X: {(value.x * 100).toFixed(1)}%</div>
        <div>Y: {(value.y * 100).toFixed(1)}%</div>
        <div>çŠ¶æ€: {active ? 'æ‹–åŠ¨ä¸­' : 'ç©ºé—²'}</div>
      </div>
    </div>
  );
}
```

## é¢œè‰²é€‰æ‹©å™¨

ä½¿ç”¨ useMove åˆ›å»ºé¢œè‰²é€‰æ‹©å™¨ï¼š

```jsx live
function Demo() {
  const [value, setValue] = useState({ x: 0.5, y: 0.5 });
  const { ref } = useMove(setValue);

  const hue = Math.round(value.x * 360);
  const lightness = Math.round((1 - value.y) * 100);
  const color = `hsl(${hue}, 100%, ${lightness}%)`;

  return (
    <div>
      <div
        ref={ref}
        style={{
          width: '100%',
          height: '200px',
          background: `linear-gradient(to bottom, white, transparent, black),
                       linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00)`,
          borderRadius: '8px',
          position: 'relative',
          cursor: 'crosshair',
        }}
      >
        <div
          style={{
            position: 'absolute',
            left: `${value.x * 100}%`,
            top: `${value.y * 100}%`,
            width: '16px',
            height: '16px',
            border: '2px solid white',
            borderRadius: '50%',
            boxShadow: '0 0 0 1px rgba(0,0,0,0.3)',
            transform: 'translate(-50%, -50%)',
          }}
        />
      </div>
      <div
        style={{
          marginTop: '12px',
          padding: '20px',
          backgroundColor: color,
          borderRadius: '6px',
          textAlign: 'center',
          color: lightness > 50 ? '#000' : '#fff',
          fontWeight: 'bold',
        }}
      >
        {color}
      </div>
    </div>
  );
}
```

## æ»‘å—æ§åˆ¶

åˆ›å»ºäºŒç»´æ»‘å—ï¼š

```jsx live
function Demo() {
  const [position, setPosition] = useState({ x: 0.5, y: 0.5 });
  const { ref, active } = useMove(setPosition);

  const size = 50 + position.x * 150;
  const opacity = 0.3 + position.y * 0.7;

  return (
    <div>
      <div
        ref={ref}
        style={{
          width: '100%',
          height: '200px',
          backgroundColor: 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: active ? 'grabbing' : 'grab',
        }}
      >
        <div
          style={{
            width: `${size}px`,
            height: `${size}px`,
            backgroundColor: 'var(--ifm-color-primary)',
            opacity,
            borderRadius: '8px',
            transition: active ? 'none' : 'all 0.2s',
          }}
        />
      </div>
      <div
        style={{
          marginTop: '12px',
          padding: '12px',
          backgroundColor: 'var(--ifm-background-surface-color)',
          border: '1px solid var(--ifm-color-emphasis-300)',
          borderRadius: '6px',
          fontSize: '14px',
        }}
      >
        <div>å¤§å°: {size.toFixed(0)}px (X è½´æ§åˆ¶)</div>
        <div>ä¸é€æ˜åº¦: {opacity.toFixed(2)} (Y è½´æ§åˆ¶)</div>
      </div>
    </div>
  );
}
```

## å¸¦å›è°ƒçš„æ‹–åŠ¨

ä½¿ç”¨æ‹–åŠ¨å¼€å§‹å’Œç»“æŸå›è°ƒï¼š

```jsx live
function Demo() {
  const [value, setValue] = useState({ x: 0.5, y: 0.5 });
  const [log, setLog] = useState([]);

  const { ref, active } = useMove(setValue, {
    onScrubStart: () => {
      setLog((prev) => [...prev, 'å¼€å§‹æ‹–åŠ¨']);
    },
    onScrubEnd: () => {
      setLog((prev) => [...prev, 'ç»“æŸæ‹–åŠ¨']);
    },
  });

  return (
    <div>
      <div
        ref={ref}
        style={{
          width: '100%',
          height: '150px',
          backgroundColor: active ? 'var(--ifm-color-primary-lightest)' : 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: '48px',
          transition: 'background-color 0.2s',
          cursor: 'move',
        }}
      >
        {active ? 'ğŸ¯' : 'ğŸ‘†'}
      </div>
      {log.length > 0 && (
        <div
          style={{
            marginTop: '12px',
            padding: '12px',
            backgroundColor: 'var(--ifm-color-emphasis-100)',
            borderRadius: '6px',
            fontSize: '14px',
            maxHeight: '100px',
            overflow: 'auto',
          }}
        >
          <strong>äº‹ä»¶æ—¥å¿—:</strong>
          {log.slice(-5).map((item, index) => (
            <div key={index}>â€¢ {item}</div>
          ))}
        </div>
      )}
    </div>
  );
}
```

## API

### å‚æ•°

```ts
function useMove<T extends HTMLElement = HTMLDivElement>(
  onChange: (value: UseMovePosition) => void,
  handlers?: UseMoveHandlers
): UseMoveResult<T>
```

| å‚æ•° | è¯´æ˜ | ç±»å‹ | é»˜è®¤å€¼ |
|------|------|------|--------|
| onChange | ä½ç½®å˜åŒ–æ—¶çš„å›è°ƒå‡½æ•° | `(value: UseMovePosition) => void` | - |
| handlers | æ‹–åŠ¨äº‹ä»¶å¤„ç†å™¨ | `UseMoveHandlers` | - |

#### UseMovePosition

```ts
interface UseMovePosition {
  x: number;  // 0 åˆ° 1 ä¹‹é—´çš„æ°´å¹³ä½ç½®
  y: number;  // 0 åˆ° 1 ä¹‹é—´çš„å‚ç›´ä½ç½®
}
```

#### UseMoveHandlers

```ts
interface UseMoveHandlers {
  onScrubStart?: () => void;  // å¼€å§‹æ‹–åŠ¨æ—¶è°ƒç”¨
  onScrubEnd?: () => void;    // ç»“æŸæ‹–åŠ¨æ—¶è°ƒç”¨
}
```

### è¿”å›å€¼

```ts
interface UseMoveResult<T> {
  ref: React.RefObject<T>;  // è¦é™„åŠ åˆ°å…ƒç´ çš„ ref
  active: boolean;          // æ˜¯å¦æ­£åœ¨æ‹–åŠ¨
}
```

## å·¥ä½œåŸç†

1. ç›‘å¬å…ƒç´ çš„ `mousedown` å’Œ `touchstart` äº‹ä»¶
2. æ‹–åŠ¨æ—¶è·Ÿè¸ªé¼ æ ‡/è§¦æ‘¸ä½ç½®
3. è®¡ç®—ç›¸å¯¹äºå…ƒç´ çš„å½’ä¸€åŒ–åæ ‡ (0-1)
4. é€šè¿‡ `onChange` å›è°ƒè¿”å›ä½ç½®
5. æ‹–åŠ¨ç»“æŸæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

## ç‰¹æ€§

- **å½’ä¸€åŒ–åæ ‡**: å§‹ç»ˆè¿”å› 0-1 ä¹‹é—´çš„å€¼
- **è§¦æ‘¸æ”¯æŒ**: åŒæ—¶æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸äº‹ä»¶
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ requestAnimationFrame
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- **äº‹ä»¶å›è°ƒ**: å¯é€‰çš„å¼€å§‹/ç»“æŸå›è°ƒ

## ä½¿ç”¨åœºæ™¯

- **é¢œè‰²é€‰æ‹©å™¨**: äºŒç»´è‰²å½©å’Œäº®åº¦é€‰æ‹©
- **æ»‘å—æ§åˆ¶**: è‡ªå®šä¹‰èŒƒå›´æ»‘å—
- **å›¾ç‰‡è£å‰ª**: æ‹–åŠ¨é€‰æ‹©åŒºåŸŸ
- **æ¸¸æˆæ§åˆ¶**: è™šæ‹Ÿæ‘‡æ†
- **æ•°æ®å¯è§†åŒ–**: äº¤äº’å¼å›¾è¡¨
- **éŸ³é‡/äº®åº¦**: äºŒç»´æ§åˆ¶é¢æ¿

## æ³¨æ„äº‹é¡¹

- åæ ‡å€¼å§‹ç»ˆåœ¨ 0-1 èŒƒå›´å†…
- `active` çŠ¶æ€å¯ç”¨äºæ˜¾ç¤ºè§†è§‰åé¦ˆ
- è§¦æ‘¸äº‹ä»¶ä¼šè°ƒç”¨ `preventDefault`
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

## å®é™…åº”ç”¨

### éŸ³é‡å’Œå¹³è¡¡æ§åˆ¶

```jsx
function VolumeControl() {
  const [value, setValue] = useState({ x: 0.5, y: 0.5 });
  const { ref, active } = useMove(setValue);

  const volume = Math.round(value.y * 100);
  const balance = Math.round((value.x - 0.5) * 200);

  return (
    <div>
      <div ref={ref} style={{ width: '300px', height: '300px', ... }}>
        {/* æ§åˆ¶å™¨ UI */}
      </div>
      <div>
        éŸ³é‡: {volume}% | å¹³è¡¡: {balance > 0 ? 'R' : 'L'} {Math.abs(balance)}
      </div>
    </div>
  );
}
```

### å›¾ç‰‡ç„¦ç‚¹é€‰æ‹©

```jsx
function ImageFocus() {
  const [focus, setFocus] = useState({ x: 0.5, y: 0.5 });
  const { ref } = useMove(setFocus);

  return (
    <div ref={ref} style={{ position: 'relative' }}>
      <img src="image.jpg" style={{ width: '100%' }} />
      <div
        style={{
          position: 'absolute',
          left: `${focus.x * 100}%`,
          top: `${focus.y * 100}%`,
          width: '50px',
          height: '50px',
          border: '2px solid white',
          borderRadius: '50%',
          transform: 'translate(-50%, -50%)',
        }}
      />
    </div>
  );
}
```

## æœ€ä½³å®è·µ

- ä½¿ç”¨ `active` çŠ¶æ€æä¾›æ‹–åŠ¨åé¦ˆ
- æ·»åŠ è§†è§‰æŒ‡ç¤ºå™¨æ˜¾ç¤ºå½“å‰ä½ç½®
- è€ƒè™‘ä¸ºè§¦æ‘¸è®¾å¤‡ä¼˜åŒ–è§¦æ‘¸ç›®æ ‡å¤§å°
- æä¾›é”®ç›˜è®¿é—®çš„æ›¿ä»£æ–¹æ¡ˆ
- åœ¨æ‹–åŠ¨æ—¶ç¦ç”¨æ–‡æœ¬é€‰æ‹©
