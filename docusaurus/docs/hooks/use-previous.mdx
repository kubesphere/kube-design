---
sidebar_position: 13
---

# usePrevious

è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼çš„ Hookã€‚

## åŸºæœ¬ç”¨æ³•

```jsx live
function Demo() {
  const [count, setCount] = useState(0);
  const previousCount = usePrevious(count);

  return (
    <div>
      <div
        style={{
          padding: '20px',
          backgroundColor: 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
          marginBottom: '12px',
        }}
      >
        <div style={{ marginBottom: '8px' }}>
          å½“å‰å€¼: <strong style={{ fontSize: '24px', color: 'var(--ifm-color-primary)' }}>{count}</strong>
        </div>
        <div>
          ä¸Šä¸€æ¬¡çš„å€¼: <strong>{previousCount ?? 'æ— '}</strong>
        </div>
        {previousCount !== undefined && (
          <div style={{ marginTop: '8px', color: 'var(--ifm-color-emphasis-700)' }}>
            å˜åŒ–: {count - previousCount > 0 ? '+' : ''}{count - previousCount}
          </div>
        )}
      </div>
      <Group spacing="md">
        <Button onClick={() => setCount(count + 1)}>+1</Button>
        <Button onClick={() => setCount(count - 1)}>-1</Button>
        <Button onClick={() => setCount(0)} variant="outline">é‡ç½®</Button>
      </Group>
    </div>
  );
}
```

## æ¯”è¾ƒè¾“å…¥å˜åŒ–

æ£€æµ‹è¾“å…¥å€¼çš„å˜åŒ–ï¼š

```jsx live
function Demo() {
  const [input, setInput] = useState('');
  const previousInput = usePrevious(input);

  const hasChanged = input !== previousInput;

  return (
    <div>
      <Input
        placeholder="è¾“å…¥æ–‡å­—"
        value={input}
        onChange={(e) => setInput(e.target.value)}
      />
      <div
        style={{
          marginTop: '12px',
          padding: '12px',
          backgroundColor: hasChanged ? 'var(--ifm-color-warning-lightest)' : 'var(--ifm-color-success-lightest)',
          borderRadius: '6px',
        }}
      >
        <div>å½“å‰è¾“å…¥: <strong>{input || '(ç©º)'}</strong></div>
        <div>ä¸Šæ¬¡è¾“å…¥: <strong>{previousInput || '(ç©º)'}</strong></div>
        <div style={{ marginTop: '8px' }}>
          {hasChanged ? 'âœï¸ å†…å®¹å·²æ”¹å˜' : 'âœ“ å†…å®¹æœªå˜'}
        </div>
      </div>
    </div>
  );
}
```

## è¡¨å•çŠ¶æ€è·Ÿè¸ª

è¿½è¸ªè¡¨å•æäº¤çŠ¶æ€çš„å˜åŒ–ï¼š

```jsx live
function Demo() {
  const [status, setStatus] = useState('idle');
  const previousStatus = usePrevious(status);

  const handleSubmit = () => {
    setStatus('loading');
    setTimeout(() => setStatus('success'), 1500);
    setTimeout(() => setStatus('idle'), 3000);
  };

  const statusConfig = {
    idle: { label: 'ç©ºé—²', color: 'var(--ifm-color-emphasis-300)', icon: 'âšª' },
    loading: { label: 'åŠ è½½ä¸­', color: 'var(--ifm-color-primary)', icon: 'ğŸ”µ' },
    success: { label: 'æˆåŠŸ', color: 'var(--ifm-color-success)', icon: 'ğŸŸ¢' },
  };

  return (
    <div>
      <Button onClick={handleSubmit} disabled={status === 'loading'}>
        æäº¤è¡¨å•
      </Button>
      <div
        style={{
          marginTop: '16px',
          padding: '16px',
          backgroundColor: 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
        }}
      >
        <div style={{ marginBottom: '8px' }}>
          {statusConfig[status].icon} å½“å‰çŠ¶æ€: <strong>{statusConfig[status].label}</strong>
        </div>
        {previousStatus && (
          <div style={{ fontSize: '14px', color: 'var(--ifm-color-emphasis-700)' }}>
            ä» "{statusConfig[previousStatus].label}" å˜ä¸º "{statusConfig[status].label}"
          </div>
        )}
      </div>
    </div>
  );
}
```

## åŠ¨ç”»è¿‡æ¸¡

åŸºäºå€¼çš„å˜åŒ–è§¦å‘åŠ¨ç”»ï¼š

```jsx live
function Demo() {
  const [value, setValue] = useState(50);
  const previousValue = usePrevious(value);

  const isIncreasing = previousValue !== undefined && value > previousValue;
  const isDecreasing = previousValue !== undefined && value < previousValue;

  return (
    <div>
      <div
        style={{
          marginBottom: '16px',
          padding: '24px',
          backgroundColor: 'var(--ifm-background-surface-color)',
          border: '1px solid var(--ifm-color-emphasis-300)',
          borderRadius: '8px',
          textAlign: 'center',
        }}
      >
        <div
          style={{
            fontSize: '48px',
            fontWeight: 'bold',
            color: isIncreasing ? 'var(--ifm-color-success)' : isDecreasing ? 'var(--ifm-color-danger)' : 'var(--ifm-color-primary)',
            transition: 'all 0.3s',
          }}
        >
          {value}
          {isIncreasing && ' â†‘'}
          {isDecreasing && ' â†“'}
        </div>
      </div>
      <Group spacing="md">
        <Button onClick={() => setValue(value - 10)}>-10</Button>
        <Button onClick={() => setValue(value + 10)}>+10</Button>
      </Group>
    </div>
  );
}
```

## API

### å‚æ•°

```ts
function usePrevious<T>(value: T): T | undefined
```

| å‚æ•° | è¯´æ˜ | ç±»å‹ | é»˜è®¤å€¼ |
|------|------|------|--------|
| value | éœ€è¦è¿½è¸ªçš„å€¼ | `T` | - |

### è¿”å›å€¼

è¿”å›ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶çš„å€¼ï¼Œé¦–æ¬¡æ¸²æŸ“æ—¶è¿”å› `undefined`ã€‚

```ts
T | undefined
```

## å·¥ä½œåŸç†

ä½¿ç”¨ `useRef` å’Œ `useEffect` å®ç°ï¼š
1. æ¯æ¬¡æ¸²æŸ“åï¼Œå°†å½“å‰å€¼ä¿å­˜åˆ° ref
2. ä¸‹æ¬¡æ¸²æŸ“æ—¶ï¼Œref ä¸­å­˜å‚¨çš„å°±æ˜¯ä¸Šä¸€æ¬¡çš„å€¼

## ä½¿ç”¨åœºæ™¯

- **å€¼å˜åŒ–æ£€æµ‹**: æ¯”è¾ƒå½“å‰å€¼å’Œä¸Šä¸€æ¬¡å€¼
- **åŠ¨ç”»è§¦å‘**: åŸºäºå€¼å˜åŒ–è§¦å‘åŠ¨ç”»
- **è¡¨å•éªŒè¯**: æ¯”è¾ƒè¡¨å•å­—æ®µå˜åŒ–
- **æ’¤é”€åŠŸèƒ½**: å®ç°ç®€å•çš„æ’¤é”€æ“ä½œ
- **çŠ¶æ€è½¬æ¢**: è¿½è¸ªçŠ¶æ€æœºçš„çŠ¶æ€ï¿½ï¿½ï¿½åŒ–
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„è®¡ç®—æˆ–è¯·æ±‚
