---
sidebar_position: 19
---

# useMergedRef

åˆå¹¶å¤šä¸ª ref åˆ°å•ä¸ª ref çš„ Hookï¼Œç”¨äºéœ€è¦å°†å¤šä¸ª ref é™„åŠ åˆ°åŒä¸€å…ƒç´ çš„åœºæ™¯ã€‚

## åŸºæœ¬ç”¨æ³•

```jsx live
function Demo() {
  const [value, setValue] = useState('');
  const inputRef = useRef(null);
  const focusRef = useRef(null);
  const mergedRef = useMergedRef(inputRef, focusRef);

  const handleFocus = () => {
    if (focusRef.current) {
      focusRef.current.focus();
    }
  };

  const handleGetValue = () => {
    if (inputRef.current) {
      setValue(inputRef.current.value);
    }
  };

  return (
    <div>
      <Input ref={mergedRef} placeholder="è¾“å…¥æ–‡æœ¬" style={{ marginBottom: '12px' }} />
      <Group spacing="md">
        <Button onClick={handleFocus}>èšç„¦è¾“å…¥æ¡†</Button>
        <Button onClick={handleGetValue}>è·å–å€¼</Button>
      </Group>
      {value && (
        <div
          style={{
            marginTop: '12px',
            padding: '12px',
            backgroundColor: 'var(--ifm-color-emphasis-100)',
            borderRadius: '6px',
          }}
        >
          <strong>è¾“å…¥å€¼:</strong> {value}
        </div>
      )}
    </div>
  );
}
```

## ä¸ Hook é…åˆ

ç»“åˆè‡ªå®šä¹‰ Hook ä½¿ç”¨ï¼š

```jsx live
function Demo() {
  const hoverRef = useRef(null);
  const { ref: hoverHookRef, isHovered } = useHover();

  const mergedRef = useMergedRef(hoverRef, hoverHookRef);

  return (
    <div>
      <div
        ref={mergedRef}
        style={{
          padding: '32px',
          backgroundColor: isHovered
            ? 'var(--ifm-color-primary-lightest)'
            : 'var(--ifm-color-emphasis-100)',
          borderRadius: '8px',
          textAlign: 'center',
          cursor: 'pointer',
          transition: 'background-color 0.2s',
        }}
      >
        <div style={{ fontSize: '48px', marginBottom: '12px' }}>{isHovered ? 'ğŸ‘†' : 'ğŸ‘‡'}</div>
        <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>
          {isHovered ? 'é¼ æ ‡æ‚¬åœä¸­' : 'å°†é¼ æ ‡æ‚¬åœåœ¨è¿™é‡Œ'}
        </div>
      </div>
    </div>
  );
}
```

## è½¬å‘ ref

åœ¨ç»„ä»¶ä¸­è½¬å‘å¤šä¸ª refï¼š

```jsx live
function Demo() {
  const CustomInput = React.forwardRef((props, ref) => {
    const internalRef = useRef(null);
    const mergedRef = useMergedRef(ref, internalRef);

    useDidMount(() => {
      console.log('ç»„ä»¶å·²æŒ‚è½½ï¼Œref å·²åˆå¹¶');
    });

    return <Input ref={mergedRef} {...props} />;
  });

  const externalRef = useRef(null);

  const handleFocus = () => {
    if (externalRef.current) {
      externalRef.current.focus();
    }
  };

  return (
    <div>
      <CustomInput ref={externalRef} placeholder="è‡ªå®šä¹‰è¾“å…¥æ¡†" style={{ marginBottom: '12px' }} />
      <Button onClick={handleFocus}>å¤–éƒ¨èšç„¦</Button>
    </div>
  );
}
```

## åŠ¨æ€ ref æ•°é‡

åˆå¹¶åŠ¨æ€æ•°é‡çš„ refsï¼š

```jsx live
function Demo() {
  const [count, setCount] = useState(1);
  const refs = Array.from({ length: count }, () => useRef(null));
  const mergedRef = useMergedRef(...refs);

  const handleClick = () => {
    refs.forEach((ref, index) => {
      if (ref.current) {
        console.log(`Ref ${index + 1}:`, ref.current);
      }
    });
  };

  return (
    <div>
      <div
        style={{
          marginBottom: '12px',
          padding: '12px',
          backgroundColor: 'var(--ifm-color-emphasis-100)',
          borderRadius: '6px',
        }}
      >
        <strong>å½“å‰åˆå¹¶äº† {count} ä¸ª refs</strong>
      </div>
      <Group spacing="md" style={{ marginBottom: '12px' }}>
        <Button onClick={() => setCount(Math.max(1, count - 1))}>å‡å°‘</Button>
        <Button onClick={() => setCount(count + 1)}>å¢åŠ </Button>
        <Button onClick={handleClick}>æ—¥å¿—è¾“å‡º</Button>
      </Group>
      <div
        ref={mergedRef}
        style={{
          padding: '24px',
          backgroundColor: 'var(--ifm-background-surface-color)',
          border: '1px solid var(--ifm-color-emphasis-300)',
          borderRadius: '8px',
          textAlign: 'center',
        }}
      >
        è¿™ä¸ªå…ƒç´ è¢« {count} ä¸ª ref å¼•ç”¨
      </div>
    </div>
  );
}
```

## API

### å‚æ•°

```ts
function useMergedRef<T = any>(
  ...refs: Array<React.Ref<T> | undefined>
): (instance: T | null) => void;
```

| å‚æ•°    | è¯´æ˜              | ç±»å‹                               | é»˜è®¤å€¼ |
| ------- | ----------------- | ---------------------------------- | ------ |
| ...refs | è¦åˆå¹¶çš„ ref æ•°ç»„ | `Array<React.Ref<T> \| undefined>` | -      |

### è¿”å›å€¼

è¿”å›ä¸€ä¸ªåˆå¹¶åçš„ ref å›è°ƒå‡½æ•°ã€‚

```ts
(instance: T | null) => void
```

## æ”¯æŒçš„ ref ç±»å‹

`useMergedRef` æ”¯æŒæ‰€æœ‰ç±»å‹çš„ React refsï¼š

### Ref å¯¹è±¡

```jsx
const ref = useRef(null);
const mergedRef = useMergedRef(ref);
```

### Ref å›è°ƒ

```jsx
const refCallback = (node) => {
  console.log('Node:', node);
};
const mergedRef = useMergedRef(refCallback);
```

### è½¬å‘ Ref

```jsx
const Component = React.forwardRef((props, ref) => {
  const internalRef = useRef(null);
  const mergedRef = useMergedRef(ref, internalRef);
  return <div ref={mergedRef} />;
});
```

## å·¥ä½œåŸç†

1. æ¥æ”¶ä»»æ„æ•°é‡çš„ refsï¼ˆref å¯¹è±¡æˆ–å›è°ƒå‡½æ•°ï¼‰
2. è¿”å›ä¸€ä¸ªæ–°çš„ ref å›è°ƒå‡½æ•°
3. å½“å…ƒç´ æŒ‚è½½æˆ–æ›´æ–°æ—¶ï¼ŒåŒæ—¶æ›´æ–°æ‰€æœ‰ refs
4. è‡ªåŠ¨å¤„ç† `null` å’Œ `undefined` çš„æƒ…å†µ

## ä½¿ç”¨åœºæ™¯

- **Hook ç»„åˆ**: å¤šä¸ªéœ€è¦ ref çš„ Hook ä¸€èµ·ä½¿ç”¨
- **è½¬å‘ ref**: ç»„ä»¶å†…éƒ¨éœ€è¦ refï¼ŒåŒæ—¶å¯¹å¤–æš´éœ² ref
- **ç¬¬ä¸‰æ–¹åº“**: é›†æˆéœ€è¦ ref çš„ç¬¬ä¸‰æ–¹åº“
- **æµ‹é‡å…ƒç´ **: åŒæ—¶ç”¨äºå¤šä¸ªæµ‹é‡æˆ–ç›‘å¬ç›®çš„
- **åŠ¨ç”»åº“**: å¤šä¸ªåŠ¨ç”»åº“åŒæ—¶æ§åˆ¶ä¸€ä¸ªå…ƒç´ 

## å¸¸è§åœºæ™¯

### ä¸ useClickOutside ç»“åˆ

```jsx
function Dropdown() {
  const internalRef = useRef(null);
  const clickOutsideRef = useClickOutside(() => setOpened(false));
  const mergedRef = useMergedRef(internalRef, clickOutsideRef);

  return <div ref={mergedRef}>...</div>;
}
```

### ä¸ useHover ç»“åˆ

```jsx
function Card() {
  const cardRef = useRef(null);
  const { ref: hoverRef, isHovered } = useHover();
  const mergedRef = useMergedRef(cardRef, hoverRef);

  return <div ref={mergedRef}>...</div>;
}
```

### ä¸ forwardRef ç»“åˆ

```jsx
const Button = React.forwardRef((props, ref) => {
  const internalRef = useRef(null);
  const mergedRef = useMergedRef(ref, internalRef);

  return <button ref={mergedRef} {...props} />;
});
```

## æ³¨æ„äº‹é¡¹

- ä¼ å…¥çš„ refs å¯ä»¥æ˜¯ `undefined` æˆ– `null`ï¼Œä¼šè‡ªåŠ¨è¿‡æ»¤
- è¿”å›çš„ ref æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ”¹å˜
- æ”¯æŒä»»æ„æ•°é‡çš„ refs åˆå¹¶
- å¯¹æ€§èƒ½å½±å“æå°

## TypeScript ç±»å‹

```tsx
// åŸºæœ¬ç”¨æ³•
const ref1 = useRef<HTMLDivElement>(null);
const ref2 = useRef<HTMLDivElement>(null);
const mergedRef = useMergedRef<HTMLDivElement>(ref1, ref2);

// å¸¦å¯é€‰ ref
const mergedRef = useMergedRef<HTMLDivElement>(ref1, ref2, undefined);

// ç»„ä»¶ä¸­ä½¿ç”¨
type Props = {
  customRef?: React.Ref<HTMLDivElement>;
};

const Component = ({ customRef }: Props) => {
  const internalRef = useRef<HTMLDivElement>(null);
  const mergedRef = useMergedRef(customRef, internalRef);

  return <div ref={mergedRef} />;
};
```

## æœ€ä½³å®è·µ

- åœ¨éœ€è¦å¤šä¸ª ref æ—¶ä½¿ç”¨ï¼Œå•ä¸ª ref ç›´æ¥ä½¿ç”¨å³å¯
- ä¸ `forwardRef` é…åˆä½¿ç”¨æ—¶ç‰¹åˆ«æœ‰ç”¨
- ç¡®ä¿ä¼ å…¥çš„ refs ç±»å‹ä¸€è‡´
- å¯ä»¥å®‰å…¨åœ°ä¼ å…¥ `undefined` ä½œä¸ºå‚æ•°
